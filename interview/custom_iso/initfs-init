#!/bin/sh

echo ">>>> INIT: 开始系统认证..."

SN=$(dmidecode -s system-serial-number 2>/dev/null)
echo "读取 SN: $SN"

MAC=$(ip link show | awk '/ether/ {print $2; exit}')
echo "读取 MAC: $MAC"

IDENT="$SN$MAC"
HASH=$(echo -n "$IDENT" | sha256sum | awk '{print $1}')
echo "身份 Hash: $HASH"

AUTHORIZED_HASH="acbd1234deadbeef5678cafebabe112233445566778899aabbccddeeff001122"

if [ "$HASH" != "$AUTHORIZED_HASH" ]; then
  echo "认证失败！未授权的 SN+MAC 组合"
  echo "启动已中断。"
  exec /bin/sh
fi

echo "认证通过，继续启动..."
exec /sbin/init

chmod +x "$INITFS_DIR/init"
